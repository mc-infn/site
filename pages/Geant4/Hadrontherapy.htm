<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 2;"><b style="font-size: 12.16px;"><span lang="EN-US" style="font-size: 12.0pt; line-height: 107%; font-family: 'Arial',sans-serif; mso-ansi-language: EN-US;">
      <img class="img-thumbnail"
	 src="./img/aHad_01aCalculatedResultHadrontherapy.png" /></span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 2;"><b style="font-size: 12.16px;"><span lang="EN-US" style="font-size: 12.0pt; line-height: 107%; font-family: 'Arial',sans-serif; mso-ansi-language: EN-US;">Introduction</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span style="font-size: 12pt; font-family: Arial, sans-serif;"><!--[endif]--></span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Hadrontherapy is a Geant4-based application specifically developed to address typical needs related to the proton and ion therapy.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">It first release was in 2004. At that time Hadrontherapy was only capable to simulate a well specified proton therapy facility: the passive transport beam line installed at Laboratori Nazionali del Sud (INFN) in Catania, Italy. Today Hadrontontherapy, except that it is in continuous development, is more flexible and show many additional capabilities as respect the past.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Its geometrical set-up, for example, is now completely interchangeable permitting a simple switch between different geometrical configurations,which all share the same phantom (sensible detector) with the related features.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">It is possible to do a simulation of a generic proton/ion transport beam line; the configuration are:</span></p>
<ul type="disc">
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">Passive proton beam line, which is installed at the LNS-INFN facility in Catania for eye tumor treatment with protons at 62 MeV. </span><span style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-fareast-language: IT;">It is simulated in PassiveProtonBeamLine.cc;</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">Passive carbon beam line, which is the simulation of the transport beam line at LNS-INFN of Catania for experiments with carbon ion beams.It is simulated in PassiveCarbonBeamLine.cc; both in PassiveProtonBeamLine.cc in PassiveCarbonBeamLine.cc the user can change the geometry characteristics of beam line elements.</span></li>
</ul>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Alternatively the user can use the macro file.</span></p>
<ul type="disc">
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">Energy selector,it is simulated in EnergySelector.cc; This geometry class describes the simulation of a possible energy selector for particle beams produced in a laser-matter interaction, by means of magnetic fields</span></li>
</ul>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="Folder_structure_of_Hadrontherap"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> Folder structure of Hadrontherapy</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Hadrontherapy distribution contain different sub-folders: \src: where source .cc files are stored <br /> \include: where header .hh files are stored <br /> \macro: where a set of ready-to-use macro files are provided <br /> \experimentalData: in this director a set of reference (both experimental and analithycal) data are stored. These data are then used to perform a direct comparison with simulation results that are stored in the simulationResults folder. Data stored are better described in the README file contained inside. <br /> \SimulationOutputs: when one of the .mac file contained in the macro folder is used, simulation results are directly stored in this directory. <br /> \RootScripts: if the ROOT program is installed the User can use the scripts contained in this directory to compare directly results from the his/her simulation with reference data provided inside the experimentalData folder. <br /> Currently this folders structure is in development and reference data as well as ROOT scripts will be added in the meanwhile new features and capabilities will be added. Moreover some ROOT script can be missed. Apologize for this and contact author if you need more information, clarification or useful discussion.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="Description_of_the_macro_folder"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> Description of the \macro folder</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">In the example directory, inside the "macro" folder two macro files are actually provided for the use of hadrontherapy with proton and carbon beams: proton_therapy.mac and ion_therapy.mac. The proton_therapy.mac permits to run a simulation with the whole passive beam line installed in Catania. The carbon_therapy.mac excludes all the elements (moving the origin of the ion beam close to the water phantom) and reproduce a simple passive beam line for the use with carbon beams.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 2;"><a name="DOWNLOAD_AND_INSTALLATION"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> Download and installation</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Hadrontherapy source code is actually released inside the official distribution of the Geant4 toolkit in the $G4INSTALL/examples/advanced folder. To run Hadrontherapy you must first install the Geant4 package. Once Geant4 is installed the example must be first compiled (with the command gmake inside the ../Hadrontherapy folder). When compilation is completed the program can be executed. A complete guide for the Geant4 installation in different operating systems can be found inside the official installation Geant4 pages. If you have troubles with the Geant4 installation please send an e-mail to us.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 2;"><a name="GEOMETRICAL_SET_UP"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> Geometrical Set-Up</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">The idea of Hadrontherapy is to provide a tool useful for Users interested in the field of proton and ion therapy. These can include the simple calculation of dose distribution curves in water or other materials, the derivation of important transport parameters (stopping powers, ranges, etc.) in different geometrical set-ups and for different materials, up to the complete simulation of a real transport beam line for therapy. The main component of the simulation is the phantom, a box that can be filled with different material and where the score of different information (at moment only the energy deposited in voxels) can be performed. A more complete description of the phantom is given in the next subsection. At moment the Hadrontherapy include the simulation of the proton beam line for eye-treatments installed at the INFN-LNS facility in Catania. This is a passive beam line and it is simulated in the file PassiveProtonBeamLine.cc. In the next future an ActiveProtonBeamLine.cc will be provided for the simulation of the active scanning treatment modality.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Moreover the possibility to add a very simple set-up (a beam, a phantom where collect the informations and some simple component) will be also provided. All these configuration will be set by macro commands. There is also a facility that allows the user to make a choice between alternative geometry set-ups. This can be done by using command: /geometrySetup/selectGeometry where is either "default" for the standard hadrontherapy geometry or "Carbon" for INFN-LNS transport beam line, normally used for interdisciplinary researches with carbon and other ion beams. The water phantom to collect informations At the end of the beam line a phantom (a box of uniform material) is reproduced. Inside it, a user-defined region is divided (via the ROGeomtry classes of Geant4) in cubic and identical voxels. The voxels size can be varied as well as the voxelized region. At the end of a simulation run the energy deposited by primaries and secondaries in each voxel is collected. This information is available as an .out file or as a .root (if the </span><span style="font-size: 12pt; font-family: Arial, sans-serif;"><a title="this topic does not yet exist; you can create it." href="https://twiki.cern.ch/twiki/bin/edit/Geant4/G4ANALYSIS?topicparent=Geant4.AdvancedExamplesHadrontherapy;nowysiwyg=1"><span lang="EN-US">G4ANALYSIS</span></a></span><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">_USE_ROOT variable is defined and the ROOT interface is activated). The default sizes of the active voxelized region are 40x40x40 mm and actually the default voxel configuration is 200 x 1 x 1, which means 200 slices with 0.2 mm of thickness. Of course this default can be modified in order to obtain, for example, a matrix of 80x80x80 cubic voxels each with a lateral dimension of 0.5 mm. As concern the cut and stepMax values, the default configuration implies a cut value of 0.01 mm in the whole world (use the command /physic/setCuts 0.01 mm) and a stepMax of 0.01 mm just in the phantom (use the command /Step/waterPhantomStepMax 0.01 mm). In any case it is strongly recommended to use a stepMax value not biggernthan 5% of the dose slice thickness.</span><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> </span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 2;"><span style="font-size: 12pt; font-family: Arial, sans-serif;"><img src="images/collimator.jpg" alt="" /><img src="images/modulator.jpg" alt="" /></span><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> </span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="The_Proton_passive_beam_line_cla"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> The Proton passive beam line class file</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">The following is the description of the elements of the passive proton beam line of the Laboratori Nazionali del Sud in Catania (I). This line is completely simulated inside this class. The main elements are:</span></p>
<ul type="disc">
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The SCATTERING SYSTEM: to transversally enlarge the original beam</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The COLLIMATORS: placed along the beam line to collimate the beam;</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The RANGE SHIFTERS: to decrease the energy of the primary proton beam to a specific value;</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The MODULATOR WHEEL: to modulate the energy of the primary and mono-energetic beam in to a wide spectrum. The energy modulation is necessary to homogeneously irradiate a tumour volume that can extends in depth up to 20 mm;</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The MONITOR CHAMBERS: very thin ionisation chamber that permit the dose monitoring during the patient irradiation;</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The MOPI detector: microstrips, air free detector utilised for the check of the beam symmetry during the treatment;</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The PATIENT COLLIMATOR: a brass, tumour-shaped collimator able to confine the proton irradiation field in order to irradiate just the tumour mass in the transverse direction;</span></li>
</ul>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">The user has the possibility to vary, via messenger, almost all the geometrical characteristics of the beam line elements (i.e. their position along the beam line, their thickness, etc.). </span><span style="font-size: 12pt; font-family: Arial, sans-serif;">The elements simulated in the PassiveBeamLine.cc file are:</span></p>
<ul type="disc">
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">A scattering system, to spread geometrically the beam;</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">A system of collimators, to avoid the scattering radiation;</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">A modulation system that spreads the beam in energy and produces the so-called spread out Bragg peak; It is constituted by a rotating wheel of different thicknesses. The wheel rotates around is axis (parallel to the proton beam axis) and its movement can be obtained by means of a messenger between runs.</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">A set of monitor chambers (special transmission ionisation chambers used to control the particle flux during the irradiation);</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">A final long collimator and a patient collimator defining the final shape of the beam before reaching the patient.</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">A water phantom: it is a box of water where the energy deposit is calculated. The use of the water phantom is required by the international protocol on the measure of dose in the case of proton and ion beams (IAEA 398, 2000).</span></li>
</ul>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 2;"><a name="PHYSICS_PROCESSES_AND_PHYSICS_MO"></a><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> <b>Physics Processes and Physics Models Implementation</b></span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">A particular care is addressed to the simulation of the physic processes. Three different approaches can be used for the choose of the physic models.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="Approach_1"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> Approach 1:</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Using the macro command:</span></p>
<p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">/physic/addPhysics/&lt;physics List name&gt;.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">In this case the models (for electromagnetic, hadronic elastic and hadronic inelastic) can be activated directly calling the name of the Physics Lists that are available inside the Geant4 kernel in the directory:</span></p>
<p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">$G4INSTALL/source/physics_lists/builders/include</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">An example of the use of the Physics List can be found in the macro files: proton_therapy.mac and ion_therapy.mac</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="Approach_2"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> Approach 2:</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">A set of built-in physic models are also contained inside the Hadrontherapy directory. These are called Local*.cc and Local*.hh and can be activated using the macro command:</span></p>
<p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">/physic/addPhysics/&lt;name&gt;.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">NOTE: we do not recommend the use of local physics lists while we recommend the use of the Physics Lists or of the Reference Physics Lists (Approach 1 or 3)</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="Approach_3"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> Approach 3:</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">We developed this approach in order to simplify the choice of the physic models to be used in the application. With this approach the user must only insert a command line in his/her .mac file using the:</span></p>
<p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">/physics/addPackage &lt;PACKAGE_NAME&gt;</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">This permits to switch-on an already build physic package. Various packages are already present in the Geant4 tree: they are in the directory: geant4/source/physics_lists/lists/include In this case hadronic inelastic models are directly activated for every particle.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> </span><a name="SUGGESTED_PHYSIC_FOR_ION_BEAMS_I"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> Suggested Physic for ion beams in the range 0 - 400MeV</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Two macro files (proton_therapy.mac and ion_therapy.mac) can be used for proton and ion simulations. Also the QGSP_BIC_EMY package can be used if the <b>Approach 3</b> is preferred. INTERACTIVE COMMANDS</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="How_to_change_Phantom_and_Detect"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> How to change Phantom and Detector geometries</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">In order to let the end user to change phantom and detector geometries and voxelization, some interactive commands have been provided. All parameters are mandatory except those inside square brackets. A first set of commands let to change in the detector:</span></p>
<ul type="disc">
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The detector (box) sizes, where the X dimension is that along the beam direction.</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The voxels dimension. Changing this parameters, and/or the detector sizes, user should choose values in order to be divisors of the detector correspondent sizes.</span></li>
</ul>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">For both commands, zero or negative values mean &lt;&lt; don't change it &gt;&gt;</span></p>
<ul type="disc">
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The displacement between the phantom and the detector. In this case zero or positive values are allowed, while the negatives ones mean: &lt;&lt; don't change it&gt;&gt;.</span></li>
</ul>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Obviously all the sizes must be set in order to maintain the detector inside the phantom, otherwise system complains.</span><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> </span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="Stopping_powers_calculation"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> Stopping powers calculation</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">It is possible for the end-user to calculate, via macro command, stopping powers only for those materials inserted into G4NistMaterialBuilder class (about 300). To get stopping powers user must provide this command line on the idle interactive terminal (or into a macro file) :</span></p>
<p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">/parameter/getstopping &lt;G4_material&gt; &lt;Emin&gt; &lt;Emax&gt; &lt;nPoints&gt; &lt;[particle]&gt; &lt;[output_filename]&gt;</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">All parameters are mandatory except those inside square brackets []. Default values for parameters inside square brackets are respectively proton and standard output (usually the user console terminal). </span><span style="font-size: 12pt; font-family: Arial, sans-serif;">Parameters are respectively:</span></p>
<ul type="disc">
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The material (NIST) name (something like G4_..., the complete list of elements and materials is available into the G4NistMaterialBuilder class and can be printed to the terminal screen via the macro command: /parameter/nist )</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">Kinetic energy range in MeV and the number of data points to be retrieved (in a logarithmically uniform space)</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The particle name (proton, e+, e-, He3, neutron,... a full list can be gotten via the macro command: /particle/list).</span></li>
</ul>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Only for ions, user must firstly give them to the particle gun, for example issuing the macro commands:</span></p>
<p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> /gun/particle ion</span></p>
<p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> /gun/ion &lt;Z&gt; &lt;A&gt; &lt;[charge]&gt;</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">The output filename: if users leave this blank then the standard output is used.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="LET_calculation"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> LET calculation</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Hadrontherapy application simulates and calculates the averaged dose LET. At run time, data needed to calculate LET are collected. At the end of simulation, LET mean values are calculated and stored into a file. The Let.out file will be produced at the end of a run, where you can find the dose average LET for each tracked particles (both primary and secondary ones) and the total mean LET. </span><span style="font-size: 12pt; font-family: Arial, sans-serif;">The file is structured as follows:</span></p>
<ul type="disc">
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">The first three columns contains the voxel indexes (first index "i" refers to the beam direction);</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">Total LET (both track and dose weighted);</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-fareast-language: IT;">Secondary LET</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">LET Dose for each single ion (whose name is in the top row of the file).</span></li>
</ul>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">To activate the LET computation (HadrontherapyLet.cc), you have to execute the following command:</span></p>
<p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">/analysis/computeLet</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 2;"><a name="HOW_RUN_HADRONTHERAPY"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> How run Hadrontherapy</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Run the example in interactive mode</span></p>
<p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">    $G4WORDIR/bin/Linux-g++/Hadrontherapy</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">In this case the main file (Hadrontherapy.cc) performs different operations depending on which environment variable is activated;</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">For example, if the environment variable G4UI_USE_TCSH is activated Hadrontherapy will start with the TCSH User Interface that has many useful functionalities. On the other hand, if this first variables is not defined, the program will continue searching for the G4UI_USE_QT variable and, finally, will open the stadard G4UITerminal. Run the example using macro files</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Hadrontherapy can be launched using a macro file:</span></p>
<p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">    $G4WORDIR/bin/Linux-g++/Hadrontherapy macroFile.mac</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">The defaultMacro.mac file is contained in the main directory of Hadrontherapy while a big number of other macro are inside the /macro folder.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 2;"><a name="SIMULATION_OUTPUT"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> </span></b><b><span style="font-size: 12pt; font-family: Arial, sans-serif;">Simulation output</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span style="font-size: 12pt; font-family: Arial, sans-serif;"> <img src="images/out.jpg" alt="" /><img src="images/braggCurveComparison.jpg" alt="" /><!--[endif]--></span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="ASCII_file"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> ASCII file</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">A .out file os generated at the end of each run (DoseDeposited.out) is its default name that an be changed in the HadrontherapyMatrix.cc file. The file contains four columns; the first four columns represent the voxel indexs (that univocally identify the voxel volume) while the last column represent the energy deposited in the given voxel. By default the name of the output file is DoseDistribution.root. The name of the file can be set by using command:</span></p>
<p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal; tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">/analysis/setAnalysisFile &lt;filename&gt;</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">It is also possible to create multiple new output files in the same simulation session.</span><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> </span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="Use_of_the_AIDA_interface"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> </span></b><b><span style="font-size: 12pt; font-family: Arial, sans-serif;">Use of the AIDA interface</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">.root files can be produced usind the AIDA interface. The files are produced if the variable G4ANALYSIS_USE is set to 1 and the analysis tool (AIDA interface) is correctly installed. The file contains histograms and n-tuples. The histograms contain the Bragg curves: energy deposited versus the depth in water (in mm) for the primary beam as well as all the secondaries produced. The n-tuple contains the total 3D energy deposit in the phantom; the information is energy deposit in each voxel with respect to the position of the voxel. Note that the same information can be stored in different format, like .xml using the same AIDA interface.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 4;"><a name="Use_of_the_ROOT_analysis"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> Use of the ROOT analysis</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">Alternatively it is possible to use ROOT data analysis package directly for the production of output files, without using AIDA. In the last version, anyway, this functionality must be implemented by User. This can be accomplished by setting an ad-hoc environment variable (i.e. G4ANALYSIS_USE_ROOT) to 1 (and unsetting G4ANALYSIS_USE if you have it set), adding in the code lines to create outputs with the ROOT libraries and recompiling the application. In this case you must have ROOT installed in your machine.</span></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal; mso-outline-level: 2;"><a name="FUTURE_CHALLENGES_AND_USERS_REQU"></a><b><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;"> Future challenges and users requests</span></b></p>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span lang="EN-US" style="font-size: 12pt; font-family: Arial, sans-serif;">This is a list of future components that will be added in Hadrontherapy and of main Users requests that we hope to fulfill in the next future What is in progress</span></p>
<ul type="disc">
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">A module for the simulation of an active beam line will be provided. The Korean Group of the Proton therapy center, National Cancer Center is developing this</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">Modules for LET and RBE (Relative Biological Effectiveness) calculation. The Catania Group in Collaboration with the Turin one is working on this.</span></li>
  <li class="MsoNormal" style="line-height: normal;"><span lang="EN-US" style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: IT;">Hadrontherapy will permit the simulation of a 'basic' experiment usefull in hadrontherapy applications. User will be able to simulate thin/thick target configuration to calculate quantities like double differential cross sections of secondaries produces, or fluence and yelds of primary and secondaries in a thick block. This work is maily discussed with P. Kaitaniemi and the Group from the Helsinki Institute of Physics.</span></li>
</ul>
<p class="MsoNormal" style="mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; line-height: normal;"><span style="font-size: 12pt; font-family: Arial, sans-serif;">What is requested from Users</span></p>
<ul type="disc">
  <li class="MsoNormal" style="line-height: normal;"><span style="font-size: 12.0pt; font-family: 'Arial',sans-serif; mso-fareast-font-family: 'Times New Roman'; mso-fareast-language: IT;">Dicom interface</span></li>
  </ul>
